<template name="devLayout">
  <div class="container">
    <div class="row">
      <div id="alerts">
      </div>
    </div>
    {{yield}}
  </div>
</template>

<template name="devMain">
  {{> devNav}}
  {{> devBody}}
</template>

<template name="devBody">
  <div class="row">
    {{#if SEql 'searching' 'after'}}
      {{> findingsMap}}
      {{> subscribe}}
      {{> listOfGames}}
    {{else}}
      {{> listOfGames}}
    {{/if}}
  </div>
</template>

<template name="devNav">
  {{> optionsMain}}
  {{> optionsExtended}}
</template>

<template name="optionsMain">
  <div class="options-main row">
    {{#if SEql 'searching' 'not'}}
      {{> settings}}
      {{> startSearch}}
      {{> addGame}}
    {{else}}
      {{> searchBacktrack}}
      {{> searchInput}}
    {{/if}}
  </div>
</template>

<template name="searchBacktrack">
  {{#if SEql 'searching' 'during'}}
    {{> exitSearch}}
  {{else}}
    {{> back}}
  {{/if}}
</template>

<template name="optionsExtended">
  <div class="options-extended row">
    {{#if SEql 'searching' 'during'}}
        {{> selectGameTypes}}
        {{> runSearch}}
    {{/if}}
  </div>
</template>

<template name="listOfGames">
  <ul class="list-of-games list-group">
    {{#each games}}
      <li class="list-group-item listed-game">
        {{> listedGame}}
      </li>
    {{/each}}
  </ul>
</template>

<template name="listedGame">
  {{> gameTypeIndicator}}
  {{> gameSummary}}
  {{#if userInGame}}
    {{> addFriendsLink}}
  {{else}}
    {{> joinGameLink}}
  {{/if}}
  {{{alerts}}}
  {{> addPlayers}}
</template>

<template name="gameTypeIndicator">
  <div class="game-type-indicator">
    <img class="game-type" src="/game_types/{{type}}-26.png"
         alt="{{type}}" title="{{type}}">
  </div>
</template>

<template name="gameSummary">
  <div class="game-summary">
    <div class="game-type-day-time">{{day}} {{time}}</div>
    {{> whoIsPlaying}}
    <div class="place">
      <div class="place-name">{{placeName}}</div>
      <div class-"place-location">{{placeLocation}}</div>
    </div>
    {{#if SEql 'soloGame' _id}}
      <div class="organizer-info">
        Added by {{creator.name}}
      </div>
    {{/if}}
  </div>
</template>

<template name="whoIsPlaying">
  <div class="who-is-playing">
    {{#if playing}}
      <strong class="text-success">Playing</strong>
      + {{numNeeded}} needed
    {{else}}
      {{players.length}} playing ({{numNeeded}} needed)
    {{/if}}
  </div>
</template>

<template name="joinGameLink">
  <div class="join-game-link">
    <a class="{{#if SEql 'unauth-join' _id}}text-muted{{/if}}">Join</a>
  </div>
</template>

<template name="addFriendsLink">
  <div class="add-friends-link">
    <a><span class="glyphicon glyphicon-user"></span>
      <span class="glyphicon glyphicon-plus"></span></a>
  </div>
</template>

<template name="addPlayers">
  <div class="add-players">
    {{#if SEql 'unauth-join' _id}}
      {{#unless SEql 'sign-in-and-join' _id}}
        {{> addSelfAndFriends}}
      {{else}} <!-- sign in and join -->
        {{#if currentUser}}
          Adding you to this game...
        {{else}}
          {{> signInInline}}
        {{/if}}
      {{/unless}}
    {{/if}}
    <!-- 'unauth-join' and 'add-friends' should never both be non-null
         because 'add-friends' is for authenticated users. -->
    {{#if SEql 'add-friends' _id}}
      {{> addFriends}}
    {{/if}}
  </div>
</template>

<template name="addSelfAndFriends">
  <div class="add-self-and-friends well">
    <button type="button" class="close" aria-hidden="true">&times;</button>
    <form class="add-self-and-friends" role="form">
      <h5 class="form-heading">
        Add your info or <a class="sign-in-and-join">sign in</a> to join
      </h5>
      <div class="form-group">
        <input type="email" class="form-control email" placeholder="Your email"
               required autofocus>
      </div>
      <div class="form-group">
        <input type="text" class="form-control full-name" placeholder="Your full name"
               required>
      </div>
      {{> unauthAddFriends}}
      {{{alerts}}}
      <button type="submit" class="btn join-game">Join Game</button>
    </form>
  </div>
</template>

<template name="addFriends">
  <div class="add-friends well">
    <button type="button" class="close" aria-hidden="true">&times;</button>
    <form class="add-friends" role="form">
      {{> addFriendsInput}}
      {{{alerts}}}
      <button type="submit" class="btn add-friends">Add friends</button>
    </form>
  </div>
</template>

<template name="unauthAddFriends">
  {{#if SEql 'unauth-add-friends' _id}}
    {{> addFriendsInput}}
  {{else}}
    {{> unauthAddFriendsLink}}
  {{/if}}
</template>

<template name="unauthAddFriendsLink">
  <div class="form-group">
    <p class="form-control-static">
      <a class="unauth-add-friends-link">
        <span class="glyphicon glyphicon-plus-sign"></span>
        Add a friend</a>
    </p>
  </div>
</template>

<template name="addFriendsInput">
  <h5 class="form-heading">Add your friends</h5>
  {{#each friends}}
    <div class="form-group">
      <input type="text" class="form-control friend-name"
             placeholder="Friend's name"
             value="{{name}}" id="{{_id}}"
             required autofocus>
    </div>
    <div class="form-group">
      <input type="email" class="form-control friend-email"
             placeholder="Friend's email (optional)"
             value="{{email}}" id="{{_id}}">
    </div>
  {{/each}}
  <div class="form-group">
    <p class="form-control-static">
      <a class="add-another-friend">
        <span class="glyphicon glyphicon-plus-sign"></span>
        Add another friend</a>
    </p>
  </div>
</template>

<template name="signInInline">
  <div class="sign-in-inline well">
    <button type="button" class="close" aria-hidden="true">&times;</button>
    <form class="sign-in" role="form">
      <h5 class="form-heading">Please sign in</h5>
       <div class="form-group">
        <input type="email" class="form-control email" placeholder="Your email"
               required autofocus>
      </div>
      <div class="form-group">
        <input type="password" class="form-control password" placeholder="Your password"
               required>
      </div>
      {{{alerts}}}
      <button class="btn sign-in-inline" type="submit">Sign in</button>
    </form>
    <p class="text-center">{{#link route="get-reset-link"}}Forgot password?{{/link}}</p>
  </div>
</template>

<template name="settings">
  <div class="settings">
    {{#if currentUser}}
      <span class="glyphicon glyphicon-cog"></span>
    {{/if}}
  </div>
</template>

<template name="startSearch">
  <div class="start-search">
    <span class="glyphicon glyphicon-search"></span>
  </div>
</template>

<template name="addGame">
  <div class="add-game">
    <a>Add game</a>
  </div>
</template>

<template name="searchInput">
  <div class="search-input">
    <input type="search" placeholder="Enter Location"
           autofocus required>
  </div>
</template>

<template name="exitSearch">
  <div class="exit-search">
    <span class="glyphicon glyphicon-remove"></span>
  </div>
</template>

<template name="selectGameTypes">
  <div class="select-game-types">
    {{#each options}}
      <div><label>
        <input type="checkbox" value="{{value}}" checked>
        {{value}}
      </label></div>
    {{/each}}
  </div>
</template>

<template name="runSearch">
  <div class="run-search">
    <button type="button"
            class="btn btn-primary center-block">Find games</button>
  </div>
</template>

<template name="back">
  <div class="back">
    <span class="glyphicon glyphicon-chevron-left"></span>
  </div>
</template>

<template name="clearSearch">
  <div class="clear-search">
    <span class="glyphicon glyphicon-remove"></span>
  </div>
</template>

<template name="findingsMap">
  <div class="findings-map">
  {{#constant}}
    <div class="findings-map-wrapper">
      <div class="findings-map-canvas"></div>
    </div>
  {{/constant}}
  </div>
</template>

<template name="subscribe">
  <div class="subscribe">
    <div class="subscribe-detail">
      {{detail}}
    </div>
    {{{status}}}
  </div>
</template>

<template name="subscribeButton">
  <button type="button"
          class="btn btn-primary center-block">
    <span class="glyphicon glyphicon-envelope"></span>
    Subscribe</button>
</template>

<template name="devDetail">
  {{> devDetailNav}}
  {{> devDetailBody}}
</template>

<template name="devDetailNav">
  <div class="dev-detail-nav">
    {{> backToList}}
    {{> gameTypeIndicator}}
    {{> shareGameLink}}
    {{> editGameLink}}
    {{> copyGameLink}}
  </div>
</template>

<template name="backToList">
  <div class="back-to-list">
    {{#link route="dev"}}
      <span class="glyphicon glyphicon-chevron-left"></span>
      Pickups
    {{/link}}
  </div>
</template>

<template name="shareGameLink">
  <div class="share-game-link">
    <a><span class="glyphicon glyphicon-link"></span>
      Share</a>
  </div>
</template>

<template name="copyGameLink">
  <div class="copy-game-link">
    {{#if SEql 'copy-game-link' _id}}
      <span class="glyphicon glyphicon-link"></span>
      <input type="text"
             value="{{baseURL}}{{pathFor 'devDetail'}}"
             autofocus>
      <button type="button" class="close" aria-hidden="true">&times;</button>
    {{/if}}
  </div>
</template>

<template name="editGameLink">
  {{#if isCreator}}
    <div class="edit-game-link">
      <a>Edit</a>
    </div>
  {{/if}}
</template>

<template name="devDetailBody">
  <div class="dev-detail-body">
    {{> soloGameMap}}
    {{> gameSummary}}
    {{#if userInGame}} {{> addFriendsLink}} {{/if}}
    {{{alerts}}}
    {{> addPlayers}}
    {{> joinOrLeave}}
    {{> organizersNote}}
    {{> whosPlayingSummary}}
    {{> comments}}
    {{> addComment}}
  </div>
</template>

<template name="soloGameMap">
  <div class="solo-game-map">
    {{#constant}}
      <div class="solo-game-map-wrapper">
        <div class="solo-game-map-canvas"></div>
      </div>
    {{/constant}}
  </div>
</template>

<template name="joinOrLeave">
  <div class="join-or-leave">
    {{#unless addingPlayers}}
      {{#unless userInGame}}
        <button type="button" class="btn join-game">Join game</button>
      {{else}}
        <button type="button" class="btn leave-game">Leave game</button>
      {{/unless}}
    {{/unless}}
  </div>
</template>

<template name="organizersNote">
  <div class="organizers-note">
    <strong>Organizer's note</strong>
    <div>{{note}}</div>
  </div>
</template>

<template name="whosPlayingSummary">
  <div class="whos-playing-summary">
    <strong>{{players.length}} playing</strong>
    <ul>
    {{#each userPlayers}}
      <li>
        {{name}}
        {{#with friends ../players}}
          + {{numFriends}}
        {{/with}}
      </li>
    {{/each}}
    </ul>
  </div>
</template>

<template name="comments">
  <div class="comments">
    <strong>{{numComments}}
      {{pluralize comments 'Comment' 'Comments'}}</strong>
    <ul>
      {{#each comments}}
        <li> {{> gameComment}} </li>
      {{/each}}
    </ul>
  </div>
</template>

<template name="addComment">
  <div class="add-comment">
    {{#if SGet 'unauth-comment'}}
      {{#unless SEql 'sign-in-and-comment-on' _id}}
        {{> addInfoAndComment}}
      {{else}} <!-- sign in and comment -->
        {{#if currentUser}}
          Adding comment...
        {{else}}
          {{> signInInline}}
        {{/if}}
      {{/unless}}
    {{else}}
      <form class="add-comment" role="form">
        <div class="form-group">
          <input class="form-control comment"
                 type="text"
                 placeholder="Add comment or question">
        </div>
      </form>
    {{/if}}
  </div>
</template>

<template name="addInfoAndComment">
  <div class="add-info-and-comment">
    <button type="button" class="close" aria-hidden="true">&times;</button>
    <form class="add-info-and-comment" role="form">
      <h5 class="form-heading">
        Add your info or <a class="sign-in-and-comment-on">sign in</a>
        to comment
      </h5>
      <div class="form-group">
        <input type="email" class="form-control email"
               placeholder="Your email"
               required autofocus>
      </div>
      <div class="form-group">
        <input type="text" class="form-control full-name"
               placeholder="Your full name"
               required>
      </div>
      <div class="form-group">
        <input class="form-control comment"
               type="text"
               placeholder="Add comment or question"
               value="{{SGet 'unauth-comment'}}">
      </div>
      {{{alerts}}}
      <button type="submit" class="btn add-comment">Add Comment</button>
    </form>
  </div>
</template>
